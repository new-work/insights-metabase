---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: "<%= name %>"
  namespace: insights
  labels:
    deploymentName: metabase
spec:
  schedule: "<%= schedule %>"
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  concurrencyPolicy: Forbid
  startingDeadlineSeconds: 900
  jobTemplate:
    metadata:
      annotations:
        #com.xing.jobstatus-notifier/on-failure: 'your-mailing-list@xing.com'
        #com.xing.jobstatus-notifier/on-success: 'your-mailing-list@xing.com'
    spec:
      template:
        spec:
          imagePullSecrets:
          - name: quay-pull-secret
          containers:
          - name: "<%= name %>"
            image: <%= "quay.dc.xing.com/insights/metabase:#{tag}" %>
            args: <%= args %>
            envFrom: <%= partial "envFrom" %>
            resources:
              requests:
                cpu: "<%= cpu %>"
                memory: "<%= memory %>"
          restartPolicy: Never
